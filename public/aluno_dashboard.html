<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal do Aluno - Sistema Crescer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .hero-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: calc(100vh - 64px); /* Altura da tela menos a altura da navbar */
            background-color: #f3f4f6;
            padding: 2rem;
            text-align: center;
        }
        .main-card {
            background-color: #ffffff;
            border-radius: 1.5rem; /* Bordas mais arredondadas */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1); /* Sombra mais pronunciada */
            padding: 3rem;
            max-width: 600px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2rem; /* Espaçamento entre os elementos */
        }
        .action-button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 1.5rem 2rem; /* Aumentar padding para botões maiores */
            border-radius: 1rem; /* Bordas arredondadas para os botões */
            font-size: 1.5rem; /* Texto maior nos botões */
            font-weight: 700;
            color: #ffffff;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .action-button:hover {
            transform: translateY(-3px); /* Efeito de elevação */
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }
        .button-boletim { background-color: #4CAF50; /* Verde */ }
        .button-boletim:hover { background-color: #45a049; }
        .button-mensalidades { background-color: #008CBA; /* Azul */ }
        .button-mensalidades:hover { background-color: #007bb5; }

        /* Esconder o seletor de ano do boletim se não for para esta página */
        .boletim-year-select {
            display: none; 
        }
    </style>
</head>
<body>
    <nav class="bg-gray-800 p-4 shadow-md">
        <div class="container mx-auto flex justify-between items-center max-w-full px-4">
            <a href="#" class="text-white text-2xl font-bold">Sistema Crescer</a>
             <div class="flex space-x-4">
                <a href="trocar_senha.html" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-base font-medium">Trocar Senha</a>
                <button onclick="logout()" class="text-gray-300 hover:bg-gray-700 hover:text-white px-3 py-2 rounded-md text-base font-medium">Sair</button>
            </div>
        </div>
    </nav>

    <main class="hero-section">
        <div class="main-card">
            <h1 id="welcome-message" class="text-4xl font-extrabold text-gray-800 mb-4">Carregando...</h1>
            <p id="turma-info" class="text-lg text-gray-600 mb-6"></p>

            <a id="btn-boletim" href="#" class="action-button button-boletim">BOLETIM</a>
            <a id="btn-mensalidades" href="#" class="action-button button-mensalidades">FINANCEIRO</a>

            </div>

        <div id="loading-message" class="text-center text-gray-500 mt-8">Carregando dados...</div>
        <div id="error-message" class="hidden mt-8 p-4 bg-red-100 text-red-700 rounded-lg"></div>
    </main>

    <script>
        const API_BASE_URL = 'http://localhost/Sistema/api';
        const API_LOGIN_URL = 'login.html';

        let currentAlunoData = null;

        function logout() {
            localStorage.clear();
            window.location.href = API_LOGIN_URL;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            const token = localStorage.getItem('jwt_token');
            if (!token) { logout(); return; }

            try {
                const decodedToken = JSON.parse(atob(token.split('.')[1]));
                const alunoRA = decodedToken?.data?.username;
                if (!alunoRA) throw new Error("Token de aluno inválido ou incompleto.");

                // Apenas busca os dados do aluno logado
                const alunoRes = await fetch(`${API_BASE_URL}/alunos?ra=${alunoRA}`, { 
                    headers: { 'Authorization': `Bearer ${token}` } 
                });
                
                if (!alunoRes.ok) {
                    const errorBody = await alunoRes.json();
                    throw new Error(errorBody.message || "Falha ao carregar dados do aluno.");
                }
                const alunoResult = await alunoRes.json();

                if (alunoResult.success && alunoResult.data.length > 0) {
                    currentAlunoData = alunoResult.data[0];
                    document.getElementById('welcome-message').textContent = `Olá, ${currentAlunoData.nome_aluno}!`;
                    document.getElementById('turma-info').textContent = `Turma: ${currentAlunoData.nome_turma || 'Não atribuída'} - RA: ${currentAlunoData.ra}`;

                    const currentYear = new Date().getFullYear();

                    // Configurar o link do botão BOLETIM
                    const boletimHref = `boletim_aluno_view.html?idAluno=${currentAlunoData.id_aluno}&nomeAluno=${encodeURIComponent(currentAlunoData.nome_aluno)}&raAluno=${currentAlunoData.ra}&turmaAluno=${encodeURIComponent(currentAlunoData.nome_turma || 'N/A')}&anoLetivo=${currentYear}`;
                    document.getElementById('btn-boletim').href = boletimHref;

                    // Configurar o link do botão MENSALIDADES
                    // Assumimos que a tela de mensalidades terá a lógica completa do Pix, etc.
                    // Se for uma página separada, coloque o caminho correto aqui.
                    // Por enquanto, podemos redirecionar para uma seção da dashboard (se existir)
                    // ou para uma nova página como 'aluno_mensalidades_view.html' se for criar.
                    document.getElementById('btn-mensalidades').href = 'aluno_mensalidades_view.html'; // ALTERE ISSO PARA SUA PÁGINA DE MENSALIDADES

                } else {
                    throw new Error(alunoResult.message || "Dados do aluno não encontrados.");
                }
                
                document.getElementById('loading-message').classList.add('hidden');
            } catch (error) {
                console.error("Erro no carregamento do dashboard do aluno:", error);
                document.getElementById('loading-message').textContent = 'Erro ao carregar dados. Por favor, tente novamente.';
                document.getElementById('error-message').textContent = `Detalhes: ${error.message}`;
                document.getElementById('error-message').classList.remove('hidden');
            }
        });

        // Removido: Funções relacionadas a Pix e mensalidades, que agora estarão em uma página de mensalidades dedicada.
        // Removido: renderMensalidades, handlePayment, displayPix, startPolling, etc.

    </script>
</body>
</html>